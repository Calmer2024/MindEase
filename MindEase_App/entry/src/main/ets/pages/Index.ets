import { WriteView } from '../view/WriteView';   // å¼•å…¥å†™æ—¥è®°é¡µé¢
import { HistoryView } from '../view/HistoryView'; // å¼•å…¥å†å²é¡µé¢

@Entry
@Component
struct Index {
  @State currentIndex: number = 0; // å½“å‰é€‰ä¸­çš„ Tab ç´¢å¼•
  private controller: TabsController = new TabsController();

  @State historyReloader: number = 0;

  // è‡ªå®šä¹‰ Tab æ ·å¼å‡½æ•°
  @Builder TabBuilder(title: string, targetIndex: number, selectedImg: ResourceStr, normalImg: ResourceStr) {
    Column() {
      // ç®€å•çš„å›¾æ ‡+æ–‡å­— (ä½ å¯ä»¥æ¢æˆä½ è‡ªå·±çš„å›¾ç‰‡ï¼Œæˆ–è€…ç›´æ¥ç”¨ Emoji ä»£æ›¿)
      Text(targetIndex === 0 ? 'ğŸ“' : 'ğŸ“‚')
        .fontSize(24)
        .margin({ bottom: 4 })
      Text(title)
        .fontColor(this.currentIndex === targetIndex ? '#007DFF' : '#999999')
        .fontSize(12)
    }
    .width('100%')
    .height(60)
    .justifyContent(FlexAlign.Center)
    .onClick(() => {
      this.currentIndex = targetIndex;
      this.controller.changeIndex(targetIndex);
    })
  }

  build() {
    Tabs({ barPosition: BarPosition.End, controller: this.controller }) {

      // Tab 1: å†™æ—¥è®°
      TabContent() {
        WriteView() // è°ƒç”¨æˆ‘ä»¬åˆšæ‰æ‹†åˆ†å‡ºæ¥çš„ç»„ä»¶
      }
      .tabBar(this.TabBuilder('å†™æ—¥è®°', 0, '', ''))

      // Tab 2: å†å²è®°å½•
      TabContent() {
        HistoryView({ refreshTrigger: this.historyReloader }) // è°ƒç”¨å†å²åˆ—è¡¨ç»„ä»¶
      }
      .tabBar(this.TabBuilder('å†å²', 1, '', ''))

    }
    .onChange((index: number) => {
      this.currentIndex = index;
      if (index === 1) {
        this.historyReloader++; // æ•°å­—å˜äº†ï¼ŒHistoryView å°±ä¼šæ”¶åˆ°é€šçŸ¥å¹¶åˆ·æ–°
      }
    })
    .scrollable(false) // ç¦æ­¢å·¦å³æ»‘åŠ¨åˆ‡æ¢ (é˜²æ­¢è¯¯è§¦)
  }
}